@model IEnumerable<Reservation>

<div class="hero inner-page" style="background-image: url('images/hero_1_a.jpg');">
    <div class="container">
        <div class="row align-items-end ">
            <div class="col-lg-5">
                <div class="intro">
                    <h1><strong>Rents</strong></h1>
                    <div class="custom-breadcrumbs"><a href="admin_index.html">Admin</a> <span class="mx-2">/</span> <strong>Rents</strong></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="site-section">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>Full Name</th>
                                <th>Username</th>
                                <th>Phone number</th>
                                <th>Car</th>
                                <th>Rental Date</th>
                                <th>Return Date</th>
                                <th>Total price</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            

                                @foreach (var reservation in Model)
                                {
                                <tr>
                                    <td>@reservation.User.FirstName @reservation.User.LastName</td>
                                    <td>@reservation.User.UserName</td>
                                    <td>@reservation.User.PhoneNumber</td>
                                    <td>@reservation.Car.Brand @reservation.Car.Model</td>
                                    <td>@String.Format("{0:dd-MM-yyyy}", @reservation.StartDate)</td>
                                    <td>@String.Format("{0:dd-MM-yyyy}", @reservation.EndDate)</td>
                                    <td>@reservation.RentalSum.ToString("C")</td>

                                    @if (@reservation.Status == ReservationStatus.Confirmed)
                                    {
                                        <td><span class="badge badge-success">Confirmed</span></td>
                                    }
                                    else if (@reservation.Status == ReservationStatus.Waiting)
                                    {
                                        <td><span class="badge badge-warning">Waiting...</span></td>
                                    }
                                    else if (@reservation.Status == ReservationStatus.Denied)
                                    {
                                        <td><span class="badge badge-error">Denied</span></td>
                                    }

                                    @if (@reservation.Status == ReservationStatus.Waiting)
                                    {
                                        <td class="d-flex justify-content-center">
                                            <button type="button" class="btn btn-success btn-sm mr-2" onclick="updateReservation('@reservation.Id', 'Confirmed')"                                                    id="editUserBtn">
                                                Confirm
                                            </button>
                                            <button type="button" class="btn btn-danger btn-sm" onclick="updateReservation('@reservation.Id', 'Denied')" id="deleteUserBtn">Deny</button>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>-</td>
                                    }
                                </tr>
                                }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

  </div>

@section Scripts {
    <script type="text/javascript">

        function updateReservation(id, status) {
            var formdata = new FormData();
            formdata.append("status", status);
            console.log(status);

            $.ajax({
                type: "POST",
                url: `/reservations/updateStatus/${id}`,
                cache: false,
                contentType: false,
                processData: false,
                data: formdata,
            }).done(function (data) {
                window.location.reload();
            });
        }

    </script>
}
